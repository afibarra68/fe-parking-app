<div class="printers-container">
  <div class="header">
    <h1>Impresoras</h1>
    <p-button label="Nueva Impresora" icon="pi pi-plus" (onClick)="openCreateForm()" [disabled]="loading">
    </p-button>
  </div>

  @if (!showForm) {
  <form [formGroup]="searchForm" class="search-bar">
    <div class="search-fields">
      <div class="search-field">
        <label for="printerName">Nombre</label>
        <input id="printerName" type="text" pInputText formControlName="printerName" placeholder="Buscar por nombre..."
          (keyup.enter)="search()" />
      </div>
      <div class="search-field">
        <app-select-lib formControlName="printerType" [options]="printerTypes" label="Tipo" [filter]="true"
          [virtualScroll]="false" [scrollHeight]="'200px'" [appendTo]="'body'">
        </app-select-lib>
      </div>
      <div class="search-field">
        <app-select-lib formControlName="isActive" [options]="statusOptions" label="Estado" [filter]="false"
          [virtualScroll]="false" [scrollHeight]="'200px'" [appendTo]="'body'">
        </app-select-lib>
      </div>
    </div>
    <div class="search-actions">
      <p-button label="Buscar" icon="pi pi-search" (onClick)="search()" [disabled]="loading"
        styleClass="p-button-secondary">
      </p-button>
      <p-button label="Limpiar" icon="pi pi-times" (onClick)="clearSearch()" [disabled]="loading"
        styleClass="p-button-text">
      </p-button>
    </div>
  </form>
  }

  @if (error) {
  <p-message severity="error" [text]="error || ''" [closable]="true" (onClose)="error = null">
  </p-message>
  }

  <p-dialog [(visible)]="showForm" [header]="editingPrinter ? 'Editar Impresora' : 'Nueva Impresora'" [modal]="true"
    [style]="{width: '600px'}" [closable]="true" (onHide)="cancelForm()">
    <form [formGroup]="form" (ngSubmit)="submitForm()">
      <div class="form-group">
        <label for="printerName">Nombre *</label>
        <input id="printerName" type="text" pInputText formControlName="printerName"
          [class.ng-invalid]="form.get('printerName')?.invalid && form.get('printerName')?.touched" />
        @if (form.get('printerName')?.invalid && form.get('printerName')?.touched) {
        <small class="p-error">
          El nombre es requerido
        </small>
        }
      </div>

      <div class="form-group">
        <app-select-lib formControlName="printerType" [options]="printerTypes" label="Tipo *" [filter]="true"
          [virtualScroll]="false" [scrollHeight]="'200px'" [appendTo]="'body'">
        </app-select-lib>
        @if (form.get('printerType')?.invalid && form.get('printerType')?.touched) {
        <small class="p-error">
          El tipo es requerido
        </small>
        }
      </div>

      <div class="form-group">
        <app-select-lib formControlName="paperType" [options]="paperTypes" label="Tipo de Papel *" [filter]="true"
          [virtualScroll]="false" [scrollHeight]="'200px'" [appendTo]="'body'">
        </app-select-lib>
        @if (form.get('paperType')?.invalid && form.get('paperType')?.touched) {
        <small class="p-error">
          El tipo de papel es requerido
        </small>
        }
      </div>

      <div class="form-group">
        <label for="connectionString">Cadena de Conexión *</label>
        <input id="connectionString" type="text" pInputText formControlName="connectionString"
          placeholder="COM1, nombre de impresora, o dirección de red"
          [class.ng-invalid]="form.get('connectionString')?.invalid && form.get('connectionString')?.touched" />
        @if (form.get('connectionString')?.invalid && form.get('connectionString')?.touched) {
        <small class="p-error">
          La cadena de conexión es requerida
        </small>
        }
      </div>

      <div class="form-group">
        <app-select-lib formControlName="companyCompanyId" [options]="companyOptions" label="Empresa" [filter]="true"
          [showClear]="true" [floatLabel]="false" [virtualScroll]="false" [scrollHeight]="'200px'" [appendTo]="'body'">
        </app-select-lib>
      </div>

      <div class="form-group">
        <p-checkbox formControlName="isActive" label="Activa" [binary]="true">
        </p-checkbox>
      </div>

      <div class="form-actions">
        <p-button type="submit" [label]="loading ? 'Guardando...' : (editingPrinter ? 'Actualizar' : 'Crear')"
          icon="pi pi-check" [disabled]="form.invalid || loading" [loading]="loading">
        </p-button>
        <p-button type="button" label="Cancelar" icon="pi pi-times" (onClick)="cancelForm()" [disabled]="loading"
          styleClass="p-button-secondary">
        </p-button>
      </div>
    </form>
  </p-dialog>

  @if (!showForm) {
  <div class="table-container">
    @if ((tableData$ | async); as tableData) {
    <app-table-lib [cols]="cols" [dataTable]="tableData" [hasEdit]="true" [hasDelete]="false" [hasDetail]="false"
      [hasReport]="false" (onEdit)="onTableEdit($event)" (onDelete)="onTableDelete($event)"
      (pagination)="onTablePagination($event)">
    </app-table-lib>
    }
  </div>
  }
</div>