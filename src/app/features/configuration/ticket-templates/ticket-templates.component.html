<div class="ticket-templates-container">
  <div class="header">
    <h1>Plantillas de Tirilla</h1>
    <p-button 
      label="Nueva Plantilla" 
      icon="pi pi-plus" 
      (onClick)="openCreateForm()" 
      [disabled]="loading">
    </p-button>
  </div>

  <form [formGroup]="searchForm" class="search-bar" *ngIf="!showForm">
    <div class="search-fields">
      <div class="search-field">
        <app-select-lib
          formControlName="printerType"
          [options]="printerTypes"
          label="Tipo Impresora"
          [filter]="true"
          [virtualScroll]="false"
          [scrollHeight]="'200px'"
          [appendTo]="'body'">
        </app-select-lib>
      </div>
      <div class="search-field">
        <app-select-lib
          formControlName="ticketType"
          [options]="ticketTypes"
          label="Tipo Tirilla"
          [filter]="true"
          [virtualScroll]="false"
          [scrollHeight]="'200px'"
          [appendTo]="'body'">
        </app-select-lib>
      </div>
    </div>
    <div class="search-actions">
      <p-button 
        label="Buscar" 
        icon="pi pi-search" 
        (onClick)="search()" 
        [disabled]="loading"
        styleClass="p-button-secondary">
      </p-button>
      <p-button 
        label="Limpiar" 
        icon="pi pi-times" 
        (onClick)="clearSearch()" 
        [disabled]="loading"
        styleClass="p-button-text">
      </p-button>
    </div>
  </form>

  <p-message 
    *ngIf="error" 
    severity="error" 
    [text]="error"
    [closable]="true"
    (onClose)="error = null">
  </p-message>

  <p-dialog 
    [(visible)]="showForm" 
    [header]="editingTicketTemplate ? 'Editar Plantilla de Tirilla' : 'Nueva Plantilla de Tirilla'"
    [modal]="true"
    [styleClass]="'ticket-template-dialog'"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    [contentStyle]="{overflow: 'auto', padding: '1rem'}"
    (onHide)="cancelForm()">
    <form [formGroup]="form" (ngSubmit)="submitForm()">
      <div class="form-group">
        <app-select-lib
          formControlName="printerType"
          [options]="printerTypes"
          label="Tipo de Impresora *"
          [filter]="true"
          [virtualScroll]="false"
          [scrollHeight]="'200px'"
          [appendTo]="'body'">
        </app-select-lib>
        <small 
          class="p-error" 
          *ngIf="form.get('printerType')?.invalid && form.get('printerType')?.touched">
          El tipo de impresora es requerido
        </small>
      </div>

      <div class="form-group">
        <app-select-lib
          formControlName="ticketType"
          [options]="ticketTypes"
          label="Tipo de Tirilla *"
          [filter]="true"
          [virtualScroll]="false"
          [scrollHeight]="'200px'"
          [appendTo]="'body'">
        </app-select-lib>
        <small 
          class="p-error" 
          *ngIf="form.get('ticketType')?.invalid && form.get('ticketType')?.touched">
          El tipo de tirilla es requerido
        </small>
      </div>

      <div class="form-group">
        <label for="template">Tirilla (Template ESC/POS)</label>
        <textarea 
          id="template"
          formControlName="template"
          rows="5"
          placeholder="Contenido del template ESC/POS para la tirilla..."
          class="p-inputtext template-textarea">
        </textarea>
      </div>

      <div class="form-group">
        <label for="invoice">Factura (Template ESC/POS)</label>
        <textarea 
          id="invoice"
          formControlName="invoice"
          rows="5"
          placeholder="Contenido del template ESC/POS para facturas..."
          class="p-inputtext template-textarea">
        </textarea>
      </div>

      <div class="form-group">
        <label for="entryReceipt">Comprobante de Ingreso (Template ESC/POS)</label>
        <textarea 
          id="entryReceipt"
          formControlName="entryReceipt"
          rows="5"
          placeholder="Contenido del template ESC/POS para comprobantes de ingreso..."
          class="p-inputtext template-textarea">
        </textarea>
      </div>

      <div class="form-actions">
        <p-button 
          type="submit"
          [label]="loading ? 'Guardando...' : (editingTicketTemplate ? 'Actualizar' : 'Crear')"
          icon="pi pi-check"
          [disabled]="form.invalid || loading"
          [loading]="loading">
        </p-button>
        <p-button 
          type="button"
          label="Cancelar" 
          icon="pi pi-times"
          (onClick)="cancelForm()" 
          [disabled]="loading"
          styleClass="p-button-secondary">
        </p-button>
      </div>
    </form>
  </p-dialog>

  <div *ngIf="!showForm" class="table-container">
    <app-table-lib
      *ngIf="(tableData$ | async) as tableData"
      [cols]="cols"
      [dataTable]="tableData"
      [hasEdit]="true"
      [hasDelete]="false"
      [hasDetail]="false"
      [hasReport]="false"
      (onEdit)="onTableEdit($event)"
      (onDelete)="onTableDelete($event)"
      (pagination)="onTablePagination($event)">
    </app-table-lib>
  </div>
</div>

