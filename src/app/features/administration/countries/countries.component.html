<div class="countries-container">
  <div class="header">
    <h1>Países</h1>
    <p-button 
      label="Nuevo País" 
      icon="pi pi-plus" 
      (onClick)="openCreateForm()" 
      [disabled]="loading">
    </p-button>
  </div>

  <div class="search-bar" *ngIf="!showForm">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input 
        type="text" 
        pInputText 
        [(ngModel)]="searchDescription"
        placeholder="Buscar por descripción..."
        (keyup.enter)="search()"
      />
    </span>
    <p-button 
      label="Buscar" 
      icon="pi pi-search" 
      (onClick)="search()" 
      [disabled]="loading"
      styleClass="p-button-secondary">
    </p-button>
    <p-button 
      label="Limpiar" 
      icon="pi pi-times" 
      (onClick)="searchDescription = ''; loadCountries()" 
      [disabled]="loading"
      styleClass="p-button-text">
    </p-button>
  </div>

  <p-message 
    *ngIf="error" 
    severity="error" 
    [text]="error"
    [closable]="true"
    (onClose)="error = null">
  </p-message>

  <p-dialog 
    [(visible)]="showForm" 
    [header]="editingCountry ? 'Editar País' : 'Nuevo País'"
    [modal]="true"
    [style]="{width: '600px'}"
    [closable]="true"
    (onHide)="cancelForm()">
    <form [formGroup]="form" (ngSubmit)="submitForm()">
      <div class="form-group">
        <label for="name">Nombre *</label>
        <input 
          id="name"
          type="text" 
          pInputText 
          formControlName="name"
          [class.ng-invalid]="form.get('name')?.invalid && form.get('name')?.touched"
        />
        <small 
          class="p-error" 
          *ngIf="form.get('name')?.invalid && form.get('name')?.touched">
          El nombre es requerido
        </small>
      </div>

      <div class="form-group">
        <label for="description">Descripción</label>
        <input 
          id="description"
          type="text" 
          pInputText 
          formControlName="description"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="isoCode">Código ISO</label>
          <input 
            id="isoCode"
            type="text" 
            pInputText 
            formControlName="isoCode"
            maxlength="3"
          />
        </div>

        <div class="form-group">
          <label for="timezone">Zona Horaria</label>
          <input 
            id="timezone"
            type="text" 
            pInputText 
            formControlName="timezone"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="lang">Idioma</label>
          <input 
            id="lang"
            type="text" 
            pInputText 
            formControlName="lang"
          />
        </div>

        <div class="form-group">
          <label for="currency">Moneda</label>
          <input 
            id="currency"
            type="text" 
            pInputText 
            formControlName="currency"
          />
        </div>
      </div>

      <div class="form-actions">
        <p-button 
          type="submit"
          [label]="loading ? 'Guardando...' : (editingCountry ? 'Actualizar' : 'Crear')"
          icon="pi pi-check"
          [disabled]="form.invalid || loading"
          [loading]="loading">
        </p-button>
        <p-button 
          type="button"
          label="Cancelar" 
          icon="pi pi-times"
          (onClick)="cancelForm()" 
          [disabled]="loading"
          styleClass="p-button-secondary">
        </p-button>
      </div>
    </form>
  </p-dialog>

  <div *ngIf="!showForm" class="table-container">
    <app-spinner 
      [loading]="loading"
      size="normal"
      message="Cargando países..."
      [overlay]="true">
    </app-spinner>
    
    <app-table-lib
      *ngIf="!loading"
      [cols]="cols"
      [dataTable]="tableData"
      [hasEdit]="true"
      [hasDelete]="false"
      [hasDetail]="false"
      [hasReport]="false"
      (onEdit)="onTableEdit($event)"
      (onDelete)="onTableDelete($event)"
      (pagination)="onTablePagination($event)">
    </app-table-lib>
  </div>
</div>
